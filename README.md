# 3xETF-app-1w ‚Äî Leveraged ETF Analytics & ML Dashboard

A consolidated toolkit for exploring leveraged (3x) ETF data, visualizing precomputed machine-learning strategies, and serving multiple dashboards from a shared SQLite database.

## üîç Overview

- **Primary datastore**: `etf_data.db` (SQLite) containing multi-year price history, trend indicators, and metadata for 3x leveraged ETFs such as `UPRO`, `TMF`, `SOXL`, `LABU`, `FAS`, and more.
- **Web/API layer**: `server_clean.js` (Express, port 3022) exposes REST endpoints and serves a browser dashboard.
- **Python utilities**: Lightweight HTTP servers for search/data browsing plus scripts that refresh prices and inspect ML results.
- **ML artifacts**: JSON summaries and `.h5` models generated by reinforcement-learning and fast ML pipelines. These power the dashboards without requiring retraining.

## üß± Key Components

| Area | Files | Notes |
| --- | --- | --- |
| Express server & static UI | `server_clean.js`, `public/` | Main API + tabbed dashboard with ETF tables, ML metrics, and trading summaries. |
| SQLite data | `etf_data.db` (+ `*-shm`, `*-wal`) | Shared across Node.js and Python tooling. |
| Machine learning engine | `fast_ml_strategy.py`, `ml_result_viewer_fixed.py`, JSON result files | Generates, inspects, and serves strategy outputs. |
| Python dashboards | `price_search_server.py`, `data_browser_server.py`, `start_test_dashboard_server.py`, HTML files | Targeted views for price queries, data browsers, and test-period ML dashboards. |
| Supporting docs | `FINAL_PROJECT_STRUCTURE.md`, `PROJECT_STRUCTURE.md`, `README_ML_Strategy.md`, `ESSENTIAL_FILES.md` | Architecture, ML strategy details, and file inventories. |

## ‚ö° Quick Start

> Requirements: Node.js ‚â• 18, Python ‚â• 3.9, pip, and the bundled `etf_data.db`.

### 1. Install Node.js dependencies
```bash
npm install
```
*(The manifests still carry legacy script names, so use direct commands below.)*

### 2. Launch the main dashboard (port 3022)
```bash
node server_clean.js
```
- Visit http://localhost:3022
- Tabs include ETF price grids, dataset statistics, ML model comparisons, and trading performance summaries powered by the JSON result files.

### 3. (Optional) Start auxiliary Python servers
```bash
# Price lookup utility (port 8086)
python price_search_server.py

# Interactive data browser with CSV export (port 8087)
python data_browser_server.py

# Test-period ML dashboard (auto-opens browser, default port 8080)
python start_test_dashboard_server.py
```

### 4. Update price data from Yahoo Finance
```bash
pip install -r requirements.txt
python update_prices.py
```
- Fetches the latest bars for the leveraged ETF universe defined inside `update_prices.py`.

### 5. (Optional) Regenerate ML analytics
- `python fast_ml_strategy.py` reruns the core ML pipeline.
- `python ml_result_viewer_fixed.py` inspects and summarizes generated outputs.
- Fresh results overwrite/augment the JSON files consumed by the dashboards.

## üåê Express API Reference (3022)

| Endpoint | Description |
| --- | --- |
| `GET /api/etfs` | Recent price rows with 5-day SMA and monthly trend indicators. |
| `GET /api/symbols` | Distinct ETF symbols available in the database. |
| `GET /api/stats` | Basic record counts, date span, and average close. |
| `GET /api/detailed-stats` | Extended stats including symbol counts and aggregate metrics. |
| `GET /api/prices-data` | Paginated price data with optional `symbol`, `limit`, `offset`, `sort` query parameters. |
| `GET /api/ml-results` | Aggregated model outputs from `random_forest_results.json`, `xgboost_results.json`, `lightgbm_results.json`. |
| `GET /api/ml-trading-results` | High-level results sourced from `aggressive_switching_results.json`. |
| `GET /api/trading-performance` | Scans several JSON files (`best_fast_ml_results.json`, `etf_switching_results.json`, etc.) for detailed performance breakdowns. |

Static assets in `public/` (e.g., `data-viewer.html`, `ml-trades-viewer.html`) can be opened directly or served via the Express app.

## üìä Data & ML Assets

- **Database tables**: `prices` (OHLCV + derived indicators), `etfs` (symbol metadata). Both are consumed by Node.js and Python services.
- **Model files**: `etf_switching_model.h5`, `improved_etf_model.h5`, `positive_etf_model.h5` capture trained policies.
- **Result summaries**: `*_results.json`, `single_etf_ml_switching_results*.json`, `monthly_returns_data.json`, `aggressive_switching_results.json`, and more support dashboards and REST endpoints.
- **Reports**: `ml_analysis_report.txt` and additional docs outline methodology and evaluation.

## üñ•Ô∏è Available Dashboards

| Dashboard | How to open | Highlights |
| --- | --- | --- |
| Main Express UI | `node server_clean.js` ‚Üí http://localhost:3022 | Consolidated ETF tables, ML stats, trading performance. |
| Price search | `python price_search_server.py` ‚Üí http://localhost:8086 | Search historical prices by date/ticker. |
| Data browser | `python data_browser_server.py` ‚Üí http://localhost:8087 | Filter, paginate, and export rows across the database. |
| ML test-only dashboard | `python start_test_dashboard_server.py` ‚Üí http://localhost:8080 | Focused view for the 2024-08-20 ‚Üí 2025-10-17 test window. |
| Static explorers | Open files under `public/` directly | Exploratory HTML pages (e.g., five-year summaries, trade viewers). |

## üß≠ Maintenance Tips

- Keep `server_clean.js`, `etf_data.db`, `fast_ml_strategy.py`, and all `*_results.json` files intact‚Äîthey underpin every dashboard and API.
- Legacy scripts are preserved under `backup/`; they are not required for the streamlined workflow but remain for reference.
- Review `ESSENTIAL_FILES.md` for a curated checklist, and `FINAL_PROJECT_STRUCTURE.md` for the authoritative architecture diagram.
- When adding new ML experiments, save outputs as JSON alongside existing result files so the dashboards can auto-detect them.

## üìö Further Reading

- `README_ML_Strategy.md` ‚Äî In-depth documentation of the reinforcement-learning switching approach.
- `PROJECT_STRUCTURE.md` & `FINAL_PROJECT_STRUCTURE.md` ‚Äî Architectural reference and rationale.
- `ml_analysis_report.txt` ‚Äî Summary of past performance studies.

---

**Questions or updates?** Run the relevant Python/Node scripts above, regenerate ML results as needed, and consult the supplementary docs for deeper dives into the leveraged ETF strategy stack.
